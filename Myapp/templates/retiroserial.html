{% load static %}
{% load crispy_forms_tags %}
<html>
<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <link rel="" href="https://cdn.datatables.net/fixedheader/3.1.6/css/fixedHeader.dataTables.min.css">
    <title>Retiro Serial</title>
    <h1> Agregar serial a un retiro</h1>
    <p></p>
    <style>
    form {
            margin: 20px; /* Aade margen alrededor del formulario */
            padding: 20px; /* Aade espacio interno al formulario */
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Estilo para los campos de entrada */
        .form-control {
            margin-bottom: 10px;
            /* Otros estilos personalizados segn tus preferencias */
        }
    </style>

</head>
<body>
<form action="{% url 'guardarserialretiro' %}" method="post" onsubmit="capturarValorCheckbox()">
    {% csrf_token %}
    <input type="hidden" class="form-control" id="inputretiro" name="retiro" value="{{retiro.id}}" readonly>
    <div class="col-md-6">
        <label for="inputserial" class="form-label"># Serie PMV a:</label>
        <select class="form-select" id="inputserial" name="serial">
            <option value="" disabled selected>Seleccione un serial</option>
            {% for maquina in seriales_relacionados %}
                <option value="{{ maquina.id }}" data-sala="{{ maquina.salas.nombre }}" data-sala2="{{ maquina.salas }}" data-inspired="{{ maquina.id_inspired }}" data-posicion="{{ maquina.id_posicion }}" >{{ maquina.serie_PMV }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-4">
        <label for="inputcliente" class="form-label">Cliente:</label>
        <input type="text" class="form-control" id="inputcliente" name="cliente" value="{{cliente.nombre}}" readonly>
    </div>
    <div class="col-md-4">
        <label for="inputsala" class="form-label">Sala:</label>
        <input type="text" class="form-control" id="inputsala" name="sala" readonly>
        <input type="hidden" class="form-control" id="inputsala2" name="salaoculto" readonly>
    </div>
    <div class="col-md-2">
        <label for="inputinspired" class="form-label">ID Inspired:</label>
        <input type="text" class="form-control" id="inputinspired" name="inspired" readonly>
    </div>
    <div class="col-md-2">
        <label for="inputposicion" class="form-label">Posición:</label>
        <input type="text" class="form-control" id="inputposicion" name="posicion" readonly>
    </div>
    <div class="col-md-4">
        <label for="inputfecha" class="form-label">Fecha Retiro Maquinat:</label>
        <input type="date" class="form-control" name="fecha" id="inputfecha">
    </div>
    <div class="col-md-2">
        <label for="miCheckbox" class="form-label">UMS:</label>
        <input type="checkbox" name="ums" id="miCheckbox" />
    </div>
    <button type="submit" class="btn btn-info">Guardar</button>
    <button type="button" class="btn btn-info" id="cerrarVentana">Cerrar</button>

</form>
 <script>

    function capturarValorCheckbox() {
        var checkbox = document.getElementById("miCheckbox");
        var valor = checkbox.checked ? 1 : 0;
        // Asigna el valor al campo "ums" antes de enviar el formulario
        document.getElementById("ums").value = valor;
    }

    document.getElementById('cerrarVentana').addEventListener('click', function() {
        window.close(); // Cierra la ventana emergente
    });

    document.addEventListener("DOMContentLoaded", function () {
                const selectCodigoMaquina = document.getElementById("inputserial");
                const inputsala = document.getElementById("inputsala");
                const inputsala2 = document.getElementById("inputsala2");
                const datainspired = document.getElementById("inputinspired");
                const dataposicion = document.getElementById("inputposicion");

                selectCodigoMaquina.addEventListener("change", function () {
                  const selectedOption = selectCodigoMaquina.options[selectCodigoMaquina.selectedIndex];
                  inputsala.value = selectedOption.getAttribute("data-sala");
                  inputsala2.value = selectedOption.getAttribute("data-sala2");
                  inputinspired.value = selectedOption.getAttribute("data-inspired");
                  inputposicion.value = selectedOption.getAttribute("data-posicion");
               });
             });

    // Agrega este código para manejar los mensajes enviados desde la ventana emergente
    window.addEventListener("message", function (event) {
        if (event.data) {
            alert(event.data); // Muestra el mensaje de éxito en un cuadro de diálogo
            // También puedes realizar otras acciones, como actualizar la página principal
        }
    });


</script>
<center>
    <fieldset>
        <div id="version">
            <h6>Ver. Verisón 1.0.0 (01/04/2022)</h6>
            <img src="{% static " img/logosistema.png" %}" > <br>
            <h8>Copyright ® 2019</h8>
            <br>
            <h8>SPOTGAMING S.A.S</h8>
            <br>
        </div>
    </fieldset>
</center>
</body>
</html>