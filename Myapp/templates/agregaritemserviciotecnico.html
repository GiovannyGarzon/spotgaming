{% load static %}
{% load crispy_forms_tags %}
<html>
<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <link rel="" href="https://cdn.datatables.net/fixedheader/3.1.6/css/fixedHeader.dataTables.min.css">
    <title>Retiro Serial</title>
    <h1> Agregar ITEM a servicio tecnico</h1>
    <p></p>
    <style>
    form {
            margin: 20px; /* Aade margen alrededor del formulario */
            padding: 20px; /* Aade espacio interno al formulario */
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Estilo para los campos de entrada */
        .form-control {
            margin-bottom: 10px;
            /* Otros estilos personalizados segn tus preferencias */
        }
    </style>

</head>
<body>
<form action="{% url 'guardaritemserviciotecnico' %}" method="post" onsubmit="capturarValorCheckbox()">
    {% csrf_token %}
    <input type="hidden" class="form-control" id="inputserviciotecnico" name="serviciotecnico" value="{{serviciotecnico.id}}" readonly>
    <div class="col-md-4">
        <label for="inputcliente" class="form-label">Cliente:</label>
        <input type="text" class="form-control" id="inputcliente" name="cliente" value="{{cliente.nombre}}" readonly>
    </div>
    <div class="col-md-4">
        <label for="salas" class="form-label">Sala:</label>
        <select class="form-select" id="salas" name="salas">
            <option value="">Selecciona una sala</option>
            {% for sala in salas_cliente %}
            <option value="{{ sala.id }}">{{ sala.nombre }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-6">
        <label for="seriales" class="form-label"># Serie PMV a:</label>
        <select class="form-select" id="seriales" name="seriales" disabled>
            <option value="">Selecciona una sala primero</option>
        </select>
    </div>
    <div class="col-md-4">
        <label for="inputfecha" class="form-label">Fecha Visita:</label>
        <input type="date" class="form-control" name="fechavisita" id="inputfecha">
    </div>
    <div class="col-md-4">
        <label for="inputfechacierre" class="form-label">Fecha Cierre:</label>
        <input type="date" class="form-control" name="fechacierre" id="inputfechacierre">
    </div>
    <div class="col-md-4">
        <label for="inputrepuesto" class="form-label">Repuesto:</label>
        <input type="text" class="form-control" id="inputrepuesto" name="repuesto">
    </div>
    <div class="col-md-4">
        <label for="iputobservacion" class="form-label">Observación:</label>
        <input type="text" class="form-control" id="iputobservacion" name="observacion">
    </div>
    <p></p>
    <button type="submit" class="btn btn-info">Guardar</button>
    <button type="button" class="btn btn-info" id="cerrarVentana">Cerrar</button>

</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Manejador de cambio en la selección de salas
    $("#salas").on("change", function() {
        var salaSeleccionada = $(this).val();  // Obtén el ID de la sala seleccionada
        if (salaSeleccionada) {
            // Realiza una solicitud AJAX para obtener los seriales de la sala
            $.ajax({
                url: "/obtener_maquinas_por_sala/" + salaSeleccionada + "/",
                method: "GET",
                success: function(data) {
                    // Llena el campo de selección de seriales con los resultados
                    $("#seriales").html(data);
                    // Habilita el campo de selección de seriales
                    $("#seriales").prop("disabled", false);
                },
                error: function(error) {
                    console.log("Error:", error);
                }
            });
        } else {
            // Si no se selecciona una sala, limpia y deshabilita el campo de seriales
            $("#seriales").html('<option value="">Selecciona una sala primero</option>');
            $("#seriales").prop("disabled", true);
        }
    });
});
</script>
<center>
    <fieldset>
        <div id="version">
            <h6>Ver. Verisón 1.0.0 (01/04/2022)</h6>
            <img src="{% static " img/logosistema.png" %}" > <br>
            <h8>Copyright ® 2019</h8>
            <br>
            <h8>SPOTGAMING S.A.S</h8>
            <br>
        </div>
    </fieldset>
</center>
</body>
</html>